<!-- catalog.html -->
<!-- Author: Yousif Mehsen -->
<!-- Purpose: Demo site gameDatabase -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Archivo â€” Game Catalog</title>
  <link rel="stylesheet" href="Styles.css" />
  <style>
    #filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    #results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 16px;
    }
    .game-card {
      background: rgba(0,0,0,0.6);
      border-radius: 10px;
      padding: 10px;
      color: #fff;
      text-align: center;
    }
    .game-card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 6px;
    }
    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 30px;
      background: rgba(255,255,255,0.1);
      padding: 10px 20px;
      border-radius: 8px;
    }
    nav h1 {
      font-size: 1.5rem;
    }
    footer {
      margin-top: 20px;
      text-align: center;
      font-size: 0.85rem;
      color: #aaa;
    }
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      background: #0077ff;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body class="login-body" style="overflow-y:auto; align-items:flex-start;">
  <main class="login-card" style="margin: 40px auto; max-width: 1100px;">
    <h1 class="title">Game Database</h1>
    
    <section id="search-section" style="display:flex; gap:10px; margin-bottom:15px;">
      <input 
        type="text" 
        id="searchInput" 
        placeholder="Search for a game, genre, or platform..." 
        style="flex:1; padding:8px; border-radius:6px; border:none;"
      >
      <button id="searchBtn" class="btn">Search</button>
    </section>

    <div id="filters">
      <label>Genre:
        <select id="genreSelect">
          <option value="">All</option>
          <option value="action">Action</option>
          <option value="adventure">Adventure</option>
          <option value="rpg">RPG</option>
          <option value="shooter">Shooter</option>
        </select>
      </label>

      <label>Year:
        <input type="number" id="yearInput" placeholder="e.g. 2002" min="1970" max="2025" />
      </label>

      <label>Platform:
        <select id="platformSelect">
          <option value="">All</option>
          <option value="7">PlayStation 2</option>
          <option value="8">PlayStation 3</option>
          <option value="9">PlayStation 4</option>
          <option value="18">PlayStation 5</option>
          <option value="4">PC</option>
          <option value="16">PlayStation Portable</option>
          <option value="10">Wii</option>
          <option value="11">Wii U</option>
          <option value="49">SNES</option>
          <option value="24">Game Boy Advance</option>
        </select>
      </label>

      <button id="fetchBtn" class="btn">Fetch Games</button>
      <button id="forumBtn" class="btn">Forum</button>
    </div>

    <div id="results">Loading games...</div>

    <footer>
      Data provided by <a href="https://rawg.io/" target="_blank">RAWG.io</a>
    </footer>

    <nav>
      <h1>Dashboard</h1>
      <div>
        <span id="userDisplay" style="margin-right:15px;"></span>
        <button id="manageBtn" class="btn">Manage</button>
        <button id="logoutBtn" class="btn">Logout</button>
      </div>
    </nav>
  </main>

  <script src="gameDatabase.js"></script>
  <script>
    const results = document.getElementById('results');
    async function displayGames(list) {
      if (!list.length) {
        results.innerHTML = '<p>No games found.</p>';
        return;
      }
      results.innerHTML = list.map(g => `
        <div class='game-card'>
          <img src='${g.background_image || ''}' alt='${g.name}'>
          <h3>${g.name}</h3>
          <p>${g.released || 'Unknown'}</p>
        </div>
      `).join('');
    }

    let allGames = [];

    document.getElementById('fetchBtn').onclick = async () => {
      const genre = document.getElementById('genreSelect').value;
      const year = document.getElementById('yearInput').value;
      const platform = document.getElementById('platformSelect').value;
      allGames = await fetchGames({ genre, year, platform });
      displayGames(allGames);
    };

    document.getElementById('searchBtn').addEventListener('click', () => {
      const query = document.getElementById('searchInput').value.trim().toLowerCase();
      if (query === '') {
        displayGames(allGames);
        return;
      }
      const filtered = allGames.filter(g =>
        g.name.toLowerCase().includes(query) ||
        (g.genres && g.genres.some(gen => gen.name.toLowerCase().includes(query))) ||
        (g.platforms && g.platforms.some(p => p.platform.name.toLowerCase().includes(query)))
      );
      displayGames(filtered);
    });

    document.getElementById('searchInput').addEventListener('keypress', e => {
      if (e.key === 'Enter') document.getElementById('searchBtn').click();
    });

    (async () => {
      allGames = await fetchGames();
      displayGames(allGames);
    })();
  </script>
  
  <script src="forum_script.js"></script>
  <script>document.getElementById("forumBtn").onclick = () => {
  window.location.href = "forum_test.html";
};</script>
  
  <script>
    requireAuth(); // protect page
    const user = currentUser();
    document.getElementById("userDisplay").textContent = "Logged in as " + user;
    document.getElementById("name").textContent = user;
    document.getElementById("logoutBtn").onclick = logout;
  </script>

  <script src="auth.js"></script>
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      console.log("Auth script loaded");
      requireAuth();
      const user = currentUser();.
      document.getElementById("userDisplay").textContent = "Logged in as " + user;
      document.getElementById("name").textContent = user;
      document.getElementById("logoutBtn").onclick = logout;
    });
  </script>
  <script>
  document.getElementById("manageBtn").onclick = () => {
    window.location.href = "manage.html";
  };
</script>
</body>
</html>
